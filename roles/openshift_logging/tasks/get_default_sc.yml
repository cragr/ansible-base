- name: Obtain all storage class objects
  kubernetes.core.k8s_info:
    api_version: storage.k8s.io/v1
    kind: StorageClass
  register: openshift_logging_storage_classes

- set_fact:
    openshift_logging_default_storage_class: ''

- set_fact:
    openshift_logging_default_storage_class: '{{ item.metadata.name }}'
  when:
    - item.metadata is defined
    - item.metadata.annotations is defined
    - item.metadata.annotations['storageclass.kubernetes.io/is-default-class'] is defined
    - item.metadata.annotations['storageclass.kubernetes.io/is-default-class'] == 'true'
  loop: '{{ openshift_logging_storage_classes.resources }}'

- fail:
    msg: No default storage class found on the cluster.
  when: openshift_logging_default_storage_class | length == 0
