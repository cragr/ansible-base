- import_role:
    name: openshift_autogitops
    tasks_from: app_deploy.yml
  vars:
    autogitops_app_name: kyverno-operator
    autogitops_app_path: kyverno/operator
    autogitops_app_namespace: kyverno
    autogitops_app_values: ''

- import_role:
    name: openshift_autogitops
    tasks_from: app_deploy.yml
  vars:
    autogitops_app_name: kyverno-policies
    autogitops_app_path: kyverno/policies
    autogitops_app_namespace: kyverno
    autogitops_app_values: ''

- name: Check that Kyverno started generating internal admission reports
  kubernetes.core.k8s_info:
    api_version: kyverno.io/v1alpha2
    kind: AdmissionReport
  register: kyverno_admission_reports_result
  until: kyverno_admission_reports_result.resources | length > 0
  retries: 12
  delay: 10
