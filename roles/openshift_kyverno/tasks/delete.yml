- name: Delete Kyverno policies
  kubernetes.core.helm:
    name: '{{ kyverno_name }}-policies'
    release_namespace: '{{ kyverno_namespace }}'
    state: absent
    wait: true

- name: Delete Kyverno
  kubernetes.core.helm:
    name: '{{ kyverno_name }}'
    release_namespace: '{{ kyverno_namespace }}'
    state: absent
    wait: true

- name: Delete Kyverno namespace
  kubernetes.core.k8s:
    definition: '{{ lookup("template", item) }}'
    state: absent
    wait: true
  loop:
    - kyverno-ns.yaml
