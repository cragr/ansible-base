- name: Allow Reloader to run as anyuid
  kubernetes.core.k8s:
    template:
      - stakater-reloader-ns.yaml
      - stakater-reloader-scc-role.yaml
      - stakater-reloader-scc-rolebinding.yaml
    namespace: '{{ stakater_reloader_namespace }}'

- name: Add stakater chart repo
  kubernetes.core.helm_repository:
    name: stakater
    repo_url: https://stakater.github.io/stakater-charts

- name: Deploy Reloader chart
  kubernetes.core.helm:
    name: '{{ stakater_reloader_name }}'
    chart_ref: stakater/reloader
    chart_version: '{{ stakater_reloader_chart_version | default(omit) }}'
    release_namespace: '{{ stakater_reloader_namespace }}'
    create_namespace: true
    release_values: '{{ lookup("template", "values.yaml") | from_yaml }}'
    wait: true
