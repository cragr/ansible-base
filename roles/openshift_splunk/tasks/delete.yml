- name: Delete standalone Splunk instance
  kubernetes.core.k8s:
    definition: "{{ lookup('template', '{{ item }}') }}"
    namespace: '{{ splunk_namespace }}'
    state: absent
    wait: true
  loop:
    - instance-sa.yaml
    - instance-scc-role.yaml
    - instance-scc-rolebinding.yaml
    - splunk-instance-secret.yaml
    - instance-standalone.yaml
    - instance-web-route.yaml
    - instance-hec-route.yaml

- name: Deploy Splunk operator
  kubernetes.core.k8s:
    definition: "{{ lookup('template', '{{ item }}') }}"
    namespace: '{{ splunk_namespace }}'
    state: absent
    wait: true
  loop:
    - splunk-og.yaml
    - splunk-sub.yaml

- name: Delete operator deployment
  kubernetes.core.k8s:
    api_version: apps/v1
    kind: Deployment
    name: splunk-operator-controller-manager
    namespace: '{{ splunk_namespace }}'
    state: absent
    wait: true
