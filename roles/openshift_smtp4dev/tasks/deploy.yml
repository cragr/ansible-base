- name: Deploy smtp4dev
  kubernetes.core.k8s:
    template:
      - smtp4dev-scc-rolebinding.yaml
      - smtp4dev-sa.yaml
      - smtp4dev-deploy.yaml
      - smtp4dev-svc.yaml
    namespace: '{{ openshift_smtp4dev_namespace }}'

- import_role:
    name: openshift_common
    tasks_from: wait_for_deployment.yml
  vars:
    wait_for_deployment_name: '{{ openshift_smtp4dev_name }}'
    wait_for_deployment_namespace: '{{ openshift_smtp4dev_namespace }}'

- name: Deploy oauth-proxy
  import_role:
    name: openshift_oauth_proxy
    tasks_from: deploy.yml
  vars:
    openshift_oauth_proxy_name: '{{ openshift_smtp4dev_name }}'
    openshift_oauth_proxy_namespace: '{{ openshift_smtp4dev_namespace }}'
    openshift_oauth_proxy_upstream: http://smtp4dev
