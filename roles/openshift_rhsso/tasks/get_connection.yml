- name: Obtain Keycloak route
  kubernetes.core.k8s_info:
    api_version: route.openshift.io/v1
    kind: Route
    name: keycloak
    namespace: '{{ rhsso_instance_namespace }}'
  register: keycloak_route

- name: Fail if Keycloak route doesn't exist
  fail:
    msg: Keycloak route doesn't exist. Is Keycloak installed on the cluster?
  when: keycloak_route.resources | length == 0

- name: Obtain credential-keycloak secret
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Secret
    name: credential-keycloak
    namespace: '{{ rhsso_instance_namespace }}'
  register: keycloak_secret

- name: Set Keycloak admin credentials
  set_fact:
    rhsso_username: '{{ keycloak_secret.resources.0.data.ADMIN_USERNAME | b64decode }}'
    rhsso_password: '{{ keycloak_secret.resources.0.data.ADMIN_PASSWORD | b64decode }}'
    rhsso_hostname: '{{ keycloak_route.resources.0.spec.host }}'
