- name: Delete test workload
  kubernetes.core.k8s:
    definition: "{{ lookup('pipe', 'oc kustomize ' + sandboxed_containers_kustomizations.workload) }}"
    state: absent

- name: Delete OpenShift sandboxed containers instance
  kubernetes.core.k8s:
    definition: "{{ lookup('template', item) }}"
    state: absent
  register: sandboxed_containers_kataconfig
  loop:
     - cluster-kataconfig-kataconfig.yaml

- name: Delete OpenShift sandboxed containers operator
  kubernetes.core.k8s:
    definition: "{{ lookup('pipe', 'oc kustomize ' + sandboxed_containers_kustomizations.operator) }}"
    state: absent

- import_role:
    name: openshift_common
    tasks_from: wait_for_stable_cluster.yml
  vars:
    stable_cluster_delay: 120
    stable_cluster_retries: 10
  when: sandboxed_containers_kataconfig is changed
