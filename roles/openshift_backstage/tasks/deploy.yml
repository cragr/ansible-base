- import_role:
    name: openshift_common
    tasks_from: get_cluster_domain.yml

- name: Create backstage namespace
  kubernetes.core.k8s:
    template:
      - backstage-ns.yaml

- name: Add backstage chart repo
  kubernetes.core.helm_repository:
    name: backstage
    repo_url: '{{ backstage_helm_repo }}'

- name: Deploy backstage Helm chart
  kubernetes.core.helm:
    name: '{{ backstage_name }}'
    chart_ref: backstage/backstage
    chart_version: '{{ backstage_version | default(omit) }}'
    release_namespace: '{{ backstage_namespace }}'
    release_values: '{{ lookup("template", "values.yaml") | from_yaml }}'
    wait: true

- import_tasks: report_success.yml
