- name: Check that certificate is defined
  fail:
    msg: Certificate is missing
  when: openshift_rhel_entitlement_cert | length == 0

- name: Check that key is defined
  fail:
    msg: Private key is missing
  when: openshift_rhel_entitlement_key | length == 0

- name: Configure RHEL entitlement for cluster nodes
  kubernetes.core.k8s:
    template: 50-rhel-entitlement-mc.yaml
  register: openshift_rhel_entitlement_result
  loop:
    - master
    - worker

- import_role:
    name: openshift_common
    tasks_from: wait_for_stable_cluster.yml
  vars:
    stable_cluster_delay: 120
    stable_cluster_retries: 10
  when: openshift_rhel_entitlement_result is changed
