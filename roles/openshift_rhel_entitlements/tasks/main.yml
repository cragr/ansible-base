- name: Check that certificate is defined
  fail:
    msg: Certificate is missing
  when: openshift_rhel_entitlements_cert | length == 0

- name: Check that key is defined
  fail:
    msg: Private key is missing
  when: openshift_rhel_entitlements_key | length == 0

- name: Configure RHEL entitlements for cluster nodes
  kubernetes.core.k8s:
    template: 50-rhel-entitlements-mc.yaml
  register: openshift_rhel_entitlements_result
  loop:
    - master
    - worker

- import_role:
    name: openshift_common
    tasks_from: wait_for_stable_cluster.yml
  vars:
    stable_cluster_delay: 120
    stable_cluster_retries: 10
  when: openshift_rhel_entitlements_result is changed
