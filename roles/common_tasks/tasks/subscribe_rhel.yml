- name: Enable RHSM in container
  file:
    dest: /etc/rhsm-host
    state: absent
  become: true

- name: Register with RHSM as user {{ redhat_subscription_username }}
  community.general.redhat_subscription:
    username: '{{ redhat_subscription_username }}'
    password: '{{ redhat_subscription_password }}'
    pool: '^$'
    auto_attach: false
    force_register: false
    state: present
  become: true

- name: Enable specified RHEL repositories
  community.general.rhsm_repository:
    name:
      - rhel-7-server-optional-rpms
      - rhel-7-server-extras-rpms
    state: enabled
  become: true
  when:
    - ansible_distribution_major_version | int <= 7
