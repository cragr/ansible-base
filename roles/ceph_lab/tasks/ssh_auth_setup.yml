- name: Fetch {{ ansible_user }}'s public ssh key from first node
  slurp:
    path: .ssh/id_rsa.pub
  register: cephlab_ssh_public_key
  delegate_to: '{{ groups.ceph_lab.0 }}'
  run_once: true

- name: Add ssh public key to authorized keys
  authorized_key:
    user: '{{ ansible_user }}'
    key: '{{ cephlab_ssh_public_key.content | b64decode }}'

- name: Fetch root's public ssh key from first node
  slurp:
    path: /root/.ssh/id_rsa.pub
  register: cephlab_ssh_public_key
  delegate_to: '{{ groups.ceph_lab.0 }}'
  run_once: true
  become: true

- name: Add ssh public key to authorized keys
  authorized_key:
    user: root
    key: '{{ cephlab_ssh_public_key.content | b64decode }}'
  become: true
