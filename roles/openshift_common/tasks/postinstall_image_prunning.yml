- name: Check that imagepruners CRD is available
  kubernetes.core.k8s_info:
    api_version: v1
    kind: CustomResourceDefinition
    name: imagepruners.imageregistry.operator.openshift.io
  register: imagepruners_crd

- name: Enable automatic image pruning
  kubernetes.core.k8s:
    definition: "{{ lookup('template', 'cluster-imagepruner.yml') }}"
  when: imagepruners_crd.resources | length > 0
