- name: Expose the registry via an external route
  kubernetes.core.k8s:
    template: cluster-registry.yaml

- name: Retrieve status of the integrated image registry
  kubernetes.core.k8s_info:
    api_version: imageregistry.operator.openshift.io/v1
    kind: Config
    name: cluster
  register: image_registry_config

- include_tasks: postinstall_image_registry_volume.yml
  when:
    - image_registry_config.resources | length > 0
    - image_registry_config.resources.0.spec is defined
    - image_registry_config.resources.0.spec.managementState is defined
    - image_registry_config.resources.0.spec.managementState == 'Removed'
