- name: Install python-passlib library required by the Ansible htpasswd module
  yum:
    name: python-passlib
    state: present
  when:
    - ansible_os_family is defined
    - ansible_os_family == 'RedHat'
    - ansible_distribution_major_version is version('7', '<=')
  become: true

- name: Install python-passlib library required by the Ansible htpasswd module
  yum:
    name: python3-passlib
    state: present
  when:
    - ansible_os_family is defined
    - ansible_os_family == 'RedHat'
    - ansible_distribution_major_version is version('7', '>')
  become: true

- name: Create htpasswd secret
  kubernetes.core.k8s:
    template: htpasswd-secret.yaml

- name: Create admins group
  kubernetes.core.k8s:
    template: cluster-admins-group.yaml

- name: Grant cluster-admins group the cluster-admin role
  kubernetes.core.k8s:
    definition: cluster-admin-0-clusterrolebinding.yaml
