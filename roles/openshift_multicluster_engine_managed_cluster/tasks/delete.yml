- name: Check if KlusterletAddonConfig kind exists
  kubernetes.core.k8s_info:
    api_version: apiextensions.k8s.io/v1
    kind: CustomResourceDefinition
    name: klusterletaddonconfig.spec.applicationManager
  register: klusterletaddonconfig_result

- name: Delete {{ multicluster_engine_managed_cluster.cluster_name }} managed cluster
  kubernetes.core.k8s:
    template:
      - cluster-managedcluster.yaml
      - cluster-ns.yaml
    state: absent
    wait: true
    wait_timeout: 1800
