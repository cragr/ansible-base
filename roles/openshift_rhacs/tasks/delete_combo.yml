- import_role:
    name: openshift_common
    tasks_from: delete_kubernetes_objects.yml
  vars:
    delete_kubernetes_objects:
      - api_version: platform.stackrox.io/v1alpha1
        kind: SecuredCluster
        name: stackrox-secured-cluster-services
        namespace: stackrox

- name: Delete custom webhook receiver
  import_role:
    name: openshift_webhook_receiver
    tasks_from: delete.yml
  vars:
    openshift_webhook_receiver_namespace: '{{ rhacs_instance_namespace }}'

- name: Delete smtp4dev email receiver
  import_role:
    name: openshift_smtp4dev
    tasks_from: delete.yml
  vars:
    openshift_smtp4dev_namespace: '{{ rhacs_instance_namespace }}'

- name: Delete Datadog Vector receiver
  import_role:
    name: openshift_datadog_vector
    tasks_from: delete.yml
  vars:
    datadog_vector_namespace: '{{ rhacs_instance_namespace }}'
    datadog_vector_manage_namespace: false

- import_role:
    name: openshift_minio
    tasks_from: delete.yml
  vars:
    minio_namespace: '{{ rhacs_instance_namespace }}'
    minio_manage_namespace: false

- name: Delete RHACS central
  kubernetes.core.k8s:
    template:
      - central/central-htpasswd-secret.yaml
      - central/central-db-password-secret.yaml
      - central/stackrox-central-services-central.yaml
    wait: true
    state: absent

- name: Delete stackrox namespace
  kubernetes.core.k8s:
    template: namespace/stackrox-ns.yaml
    state: absent
    wait: true

- name: Delete RHACS operator
  import_role:
    name: openshift_common
    tasks_from: delete_operator.yml
  vars:
    delete_operator_subscription_name: '{{ rhacs_subscription_name }}'
    delete_operator_subscription_namespace: '{{ rhacs_subscription_namespace }}'

- name: Delete RHACS operator namespace
  kubernetes.core.k8s:
    template:
      - operator/rhacs-operator-ns.yaml
    state: absent
    wait: true
